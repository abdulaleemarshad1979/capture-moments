<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capture Moments - Photo Gallery</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles for a more vibrant experience */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fde68a;
            background-image: linear-gradient(315deg, #fde68a 0%, #fce38a 30%, #f9d423 50%, #ff4e50 70%, #f9d423 90%, #fce38a 100%);
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        #photo-upload-input { display: none; }
        .glass-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .photo-wrapper:hover .actions-overlay { opacity: 1; }
        .actions-overlay {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
        }
        .modal { transition: opacity 0.25s ease; }
        .modal-active { overflow: hidden; }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto px-4 py-8 md:py-12">
        
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-4xl md:text-6xl font-extrabold text-white text-shadow-lg">Capture Moments</h1>
        </header>

        <div class="flex justify-center mb-8 md:mb-12">
            <label for="photo-upload-input" class="bg-pink-500 text-white font-bold py-4 px-8 rounded-full shadow-lg hover:bg-pink-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-400 transition-transform transform hover:scale-110 cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                </svg>
                Share Your Moment!
            </label>
            <input type="file" id="photo-upload-input" multiple accept="image/*">
        </div>
        
        <main id="gallery-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6 mb-8 md:mb-12">
            <div id="placeholder" class="col-span-full text-center py-16 glass-card">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <h3 class="mt-4 text-xl font-medium text-white">Gallery is Empty</h3>
                <p class="mt-1 text-white">Be the first to upload a photo!</p>
            </div>
        </main>

        <section>
            <div class="flex justify-center items-center mb-4 space-x-4">
                <h2 class="text-2xl font-bold text-white text-center">Event Location</h2>
                <button id="fun-facts-button" class="bg-purple-500 text-white font-semibold py-2 px-4 rounded-full shadow-lg hover:bg-purple-600 focus:outline-none transition-transform transform hover:scale-105 text-sm">Fun Facts âœ¨</button>
            </div>
            <p id="map-status" class="text-center text-white mb-2 font-medium"></p>
            <div class="glass-card p-4 shadow-xl">
                <iframe 
                    id="event-map"
                    class="w-full h-64 md:h-80 rounded-lg border-2 border-white"
                    frameborder="0" style="border:0"
                    src="" 
                    allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </div>
        </section>
    </div>

    <!-- Modal -->
    <div id="caption-modal" class="modal pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center opacity-0">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-md mx-auto rounded shadow-lg z-50 overflow-y-auto">
            <div class="modal-content py-4 text-left px-6">
                <div class="flex justify-between items-center pb-3">
                    <p id="modal-title" class="text-2xl font-bold">âœ¨ AI Feature</p>
                    <div class="cursor-pointer z-50" onclick="closeModal()"><svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"><path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path></svg></div>
                </div>
                <div id="caption-content" class="text-gray-700"></div>
                <div class="flex justify-end pt-2"><button class="px-4 bg-indigo-500 p-3 rounded-lg text-white hover:bg-indigo-400" onclick="closeModal()">Close</button></div>
            </div>
        </div>
    </div>
    
    <script type="module">
        const photoUploadInput = document.getElementById('photo-upload-input');
        const galleryContainer = document.getElementById('gallery-container');
        const placeholder = document.getElementById('placeholder');
        const modal = document.getElementById('caption-modal');
        const modalTitle = document.getElementById('modal-title');
        const captionContent = document.getElementById('caption-content');
        const eventMap = document.getElementById('event-map');
        const mapStatus = document.getElementById('map-status');
        const funFactsButton = document.getElementById('fun-facts-button');

        const API_KEY = "AIzaSyDgR3cWUCfoky4riphZpG3YDB9yiwWsOEU";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;

        // --- Initialize Map ---
        function initializeMap() {
            const defaultLocationUrl = "https://maps.google.com/maps?q=Aditya%20College%20of%20Engineering%20&%20Technology&t=k&z=17&ie=UTF8&iwloc=&output=embed";

            if (navigator.geolocation) {
                mapStatus.textContent = "Requesting your location...";
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        mapStatus.textContent = "Your location has been found!";
                        const { latitude, longitude } = position.coords;
                        const userLocationUrl = `https://maps.google.com/maps?q=Your+Location&ll=${latitude},${longitude}&t=k&z=17&ie=UTF8&iwloc=&output=embed`;
                        eventMap.src = userLocationUrl;
                    },
                    (error) => {
                        console.warn(`Geolocation error (${error.code}): ${error.message}`);
                        let errorMessage = "Could not get your location. Showing default event location.";
                        if (error.code === 1) { // PERMISSION_DENIED
                            errorMessage = "You denied the location request. Showing default event location.";
                        } else if (window.location.protocol !== 'https:') {
                             errorMessage = "Location access requires a secure (HTTPS) connection. Showing default event location.";
                        }
                        mapStatus.textContent = errorMessage;
                        eventMap.src = defaultLocationUrl; // Fallback to default
                    }
                );
            } else {
                mapStatus.textContent = "Geolocation is not supported by your browser. Showing default event location.";
                eventMap.src = defaultLocationUrl; // Fallback to default
            }
        }
        
        // Call map initialization on page load
        initializeMap();


        photoUploadInput.addEventListener('change', event => {
            if (event.target.files.length > 0) {
                placeholder.style.display = 'none';
            }
            for (const file of event.target.files) {
                const reader = new FileReader();
                reader.onload = e => createImageCard(e.target.result);
                reader.readAsDataURL(file);
            }
        });

        funFactsButton.addEventListener('click', getFunFacts);

        function createImageCard(imageDataUrl) {
            const photoWrapper = document.createElement('div');
            photoWrapper.className = 'photo-wrapper relative w-full h-64 rounded-lg overflow-hidden shadow-xl fade-in group';

            const img = document.createElement('img');
            img.src = imageDataUrl;
            img.className = 'w-full h-full object-cover transition-transform duration-500 transform group-hover:scale-110 group-hover:rotate-2';
            
            const overlay = document.createElement('div');
            overlay.className = 'actions-overlay absolute bottom-0 left-0 right-0 p-2 flex justify-between items-center';

            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'flex items-center space-x-2';

            const generateCaptionButton = createButton('âœ¨ Caption', () => generateCaption(imageDataUrl));
            const getTipButton = createButton('ðŸ’¡ Tip', () => getPhotoTip(imageDataUrl));
            const deleteButton = createButton('ðŸ—‘ï¸', () => {
                photoWrapper.remove();
                if (galleryContainer.querySelectorAll('.photo-wrapper').length === 0) {
                    placeholder.style.display = 'block';
                }
            });
            deleteButton.classList.add('bg-red-500', 'hover:bg-red-600', 'w-10', 'h-10', 'rounded-full', 'text-lg');

            buttonContainer.appendChild(generateCaptionButton);
            buttonContainer.appendChild(getTipButton);
            overlay.appendChild(buttonContainer);
            overlay.appendChild(deleteButton);
            photoWrapper.appendChild(img);
            photoWrapper.appendChild(overlay);
            galleryContainer.appendChild(photoWrapper);
        }

        function createButton(text, onClick) {
            const button = document.createElement('button');
            button.className = 'bg-white/80 text-black text-xs font-semibold py-2 px-3 rounded-full shadow-md hover:bg-white focus:outline-none transition-all duration-300';
            button.innerHTML = text;
            button.onclick = onClick;
            return button;
        }

        async function callGemini(prompt, imageDataUrl = null) {
            const parts = [{ text: prompt }];
            if (imageDataUrl) {
                const base64ImageData = imageDataUrl.split(',')[1];
                parts.push({ inlineData: { mimeType: "image/jpeg", data: base64ImageData } });
            }

            const payload = {
                contents: [{ parts: parts }]
            };

            try {
                const apiResponse = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!apiResponse.ok) throw new Error(`API request failed with status ${apiResponse.status}`);
                const result = await apiResponse.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text;
            } catch (error) {
                console.error("Gemini API call failed:", error);
                return "Failed to get a response. Please try again later.";
            }
        }

        async function generateCaption(imageDataUrl) {
            openModal("âœ¨ AI Generated Caption", '<div class="loader mx-auto"></div><p class="text-center mt-2">Generating caption...</p>');
            const prompt = "Describe this image from a fun college event. Make it a short, catchy caption.";
            const caption = await callGemini(prompt, imageDataUrl);
            captionContent.textContent = caption || "Sorry, I couldn't think of a caption for this image.";
        }

        async function getPhotoTip(imageDataUrl) {
            openModal("âœ¨ AI Photo Tip", '<div class="loader mx-auto"></div><p class="text-center mt-2">Thinking of a tip...</p>');
            const prompt = "You are a friendly photography coach. Look at this image and provide one simple, encouraging tip to make a photo like this even better. Focus on concepts like composition (rule of thirds, leading lines), lighting, or framing. Keep the tip short and easy to understand for a beginner.";
            const tip = await callGemini(prompt, imageDataUrl);
            captionContent.textContent = tip || "Sorry, I couldn't think of a tip for this image.";
        }

        async function getFunFacts() {
            openModal("âœ¨ Fun Fact!", '<div class="loader mx-auto"></div><p class="text-center mt-2">Discovering a fun fact...</p>');
            const prompt = "You are a friendly tour guide. Tell me one interesting or fun fact about Aditya College of Engineering & Technology in Surampalem, India. Keep it brief and exciting.";
            const fact = await callGemini(prompt); // No image data needed
            captionContent.textContent = fact || "Sorry, I couldn't find a fun fact right now.";
        }

        function openModal(title, content) {
            modalTitle.textContent = title;
            captionContent.innerHTML = content;
            modal.classList.remove('pointer-events-none', 'opacity-0');
            document.body.classList.add('modal-active');
        }

        window.closeModal = function() {
            modal.classList.add('pointer-events-none', 'opacity-0');
            document.body.classList.remove('modal-active');
        }
    </script>
</body>
</html>
